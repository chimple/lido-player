const t="dragSelectedMap";const o="selectedValues";function e(t,o,e){return(t||"")+(o?` ${o}`:"")+(e?` ${e}`:"")}function n(e){let n=false;let c=0;let a=0;let l=0;let i=0;const u=document.getElementById("container");if(!u){console.error(`Container with ID "container" not found.`);return}const f=t=>{const o=window.getComputedStyle(t).transform;if(o==="none"){return 1}else{const t=o.match(/matrix\(([^)]+)\)/);if(t){const o=t[1].split(", ");const e=parseFloat(o[0]);return e}}return 1};const d=t=>{n=true;if(t instanceof MouseEvent){c=t.clientX;a=t.clientY}else{c=t.touches[0].clientX;a=t.touches[0].clientY}e.style.opacity="0.8";e.style.cursor="grabbing";const o=window.getComputedStyle(e).transform;if(o!=="none"){const t=o.match(/matrix\(([^)]+)\)/);if(t){const o=t[1].split(", ");l=parseFloat(o[4]);i=parseFloat(o[5])}}else{l=0;i=0}document.addEventListener("mousemove",v);document.addEventListener("mouseup",b);document.addEventListener("touchmove",v);document.addEventListener("touchend",b)};const m=u.getBoundingClientRect();const h=e.getBoundingClientRect();let p=m.top-h.top;let M=m.left-h.left;const g=new MutationObserver((t=>{for(const o of t){if(o.type==="attributes"&&o.attributeName==="style"){const t=u.getBoundingClientRect();const o=e.getBoundingClientRect();p=t.top-o.top;M=t.left-o.left}}}));const x={attributes:true,attributeFilter:["style"]};g.observe(u,x);const v=t=>{if(!n)return;const o=f(u);let s=0;let r=0;if(t instanceof MouseEvent){s=(t.clientX-c)/o;r=(t.clientY-a)/o}else{s=(t.touches[0].clientX-c)/o;r=(t.touches[0].clientY-a)/o}const d=l+s;const m=i+r;const h=u.getBoundingClientRect();const g=e.getBoundingClientRect();const x=e.style.transform.match(/-?\d+(\.\d+)?/g);const v=x.map(Number);const b=g.left/o-v[0];const S=g.top-v[1];const w=h.width/o-Math.abs(M/o)-g.width/o;const E=h.left-b;const O=h.top-S;const N=h.height/o-Math.abs(p/o)-g.height/o;const y=d+b<=h.left?E:Math.min(d,w);const C=m+S<=h.top?O:Math.min(m,N);e.style.transform=`translate(${y}px, ${C}px)`;const A=document.querySelectorAll("[type='drop']");let F=null;let J=0;A.forEach((t=>{const o=t.getBoundingClientRect();const e=Math.max(0,Math.min(g.right,o.right)-Math.max(g.left,o.left));const n=Math.max(0,Math.min(g.bottom,o.bottom)-Math.max(g.top,o.top));const s=e*n;if(s>J){J=s;F=t}}));A.forEach((t=>{t.style.border="";t.style.backgroundColor=""}));if(F){F.style.border="2px dashed #ff0000";F.style.backgroundColor="rgba(255, 0, 0, 0.1)"}};const b=()=>{var c;n=false;document.removeEventListener("mousemove",v);document.removeEventListener("mouseup",b);document.removeEventListener("touchmove",v);document.removeEventListener("touchend",b);e.style.opacity="";e.style.cursor="move";const a=document.querySelectorAll("[type='drop']");a.forEach((t=>{t.style.border="";t.style.backgroundColor=""}));const l=e.getBoundingClientRect();let i=null;let u=0;a.forEach((t=>{const o=t.getBoundingClientRect();const e=Math.max(0,Math.min(l.right,o.right)-Math.max(l.left,o.left));const n=Math.max(0,Math.min(l.bottom,o.bottom)-Math.max(l.top,o.top));const s=e*n;if(s>u){u=s;i=t}}));if(!i)return;console.log("Most overlapping element:",i.getAttribute("tabindex"),i["tabindex"],e["value"]);let f=JSON.parse((c=localStorage.getItem(t))!==null&&c!==void 0?c:"{}");if(!f[i.getAttribute("tabindex")]){f[i.getAttribute("tabindex")]=[]}f[i.getAttribute("tabindex")]=[e["value"]];localStorage.setItem(t,JSON.stringify(f));const d=Object.keys(f).sort(((t,o)=>parseInt(t)-parseInt(o)));const m=d.reduce(((t,o)=>t.concat(f[o])),[]);console.log("ðŸš€ ~ onEnd ~ dragScore:",f,m);localStorage.setItem(o,JSON.stringify(m));if(i["value"]===e["value"]){console.log("ðŸš€ ~ onEnd ~ mostOverlappedElement onMatch:",i["onMatch"]);S(i);S(e);setTimeout((()=>{i.style.transition="";i.style.boxShadow="";i.style.backgroundColor="";e.style.transition="";e.style.boxShadow="";e.style.backgroundColor="";const t=i.getAttribute("onMatch");if(t){s(t,i,e)}}),1e3)}r()};const S=t=>{t.style.transition="box-shadow 0.5s ease, background-color 0.5s ease";t.style.backgroundColor="rgba(144, 238, 144, 0.7)";t.style.boxShadow="0 0 15px 7px rgba(144, 238, 144, 0.5)";setTimeout((()=>{t.style.boxShadow="0 0 0px 0px rgba(144, 238, 144, 0.0)"}),500)};e.style.cursor="move";e.style.transform="translate(0, 0)";e.addEventListener("mousedown",d);e.addEventListener("touchstart",d)}const s=(t,o,e)=>{console.log("ðŸš€ ~ executeActions ~ actionsString:",t);const n=c(t);console.log("ðŸš€ ~ executeActions ~ actions:",n);n.forEach((t=>{const n=t.actor==="this"?o:t.actor==="element"?e:document.getElementById(t.actor);console.log("ðŸš€ ~ executeActions ~ targetElement:",n,t.action);if(n){n.style[t.action]=t.value}}))};const c=t=>{const o=[];const e=t.split(";").map((t=>t.trim()));e.forEach((t=>{if(t){const[e,n]=t.split("=").map((t=>t.trim()));const s=e.lastIndexOf(".");if(s!==-1){const t=e.substring(0,s).trim();const c=e.substring(s+1).trim();o.push({actor:t,action:c,value:n.replace(/['"]/g,"")})}}}));return o};const a=(t,o)=>{const e=t.split(",").map((t=>t.trim()));let n=0;let s=new Set;for(const t of e){if(t.startsWith("(")&&t.endsWith(")")){const e=t.slice(1,-1).split("|").map((t=>t.trim()));if(n>=o.length)return false;if(!e.includes(o[n]))return false;n++}else if(t.includes("|")){const o=t.split("|").map((t=>t.trim()));for(const t of o){s.add(t)}}else{if(n>=o.length||o[n]!==t)return false;n++}}while(n<o.length){if(!s.has(o[n])){return false}s.delete(o[n]);n++}return n===o.length};function r(){var e;const n=document.getElementById("container");if(!n)return;const s=n["objective"];const c=JSON.parse((e=localStorage.getItem(o))!==null&&e!==void 0?e:"[]");const r=a(s,c);console.log("ðŸš€ ~ onActivityComplete ~ res:",r);if(r){localStorage.removeItem(o);localStorage.removeItem(t);setTimeout((()=>{l()}),1500)}}const l=()=>{const t=new CustomEvent("nextContainer");console.log("ðŸš€ ~ triggerNextContainer ~ event:",t);window.dispatchEvent(t)};export{n as e,e as f};
//# sourceMappingURL=p-8c6ef2da.js.map