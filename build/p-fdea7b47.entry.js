import{r as t,h as i,H as e,g as n,a as s}from"./p-160313d2.js";import{i as d,S as o,D as h,T as a,t as r}from"./p-4829a07b.js";const c=".col{top:var(--y, 0);left:var(--x, 0);height:var(--height, 100%);width:var(--width, 100%);background-color:var(--bgColor, #eeeeee);padding:15px;border-radius:10px;display:flex;justify-content:space-around;flex-direction:column;align-items:center}.col>*{}";const l=c;const u=class{constructor(i){t(this,i);this.id=undefined;this.value=undefined;this.height=undefined;this.width=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.bgColor=undefined;this.type=undefined;this.tabIndex=undefined;this.visible=undefined;this.audio=undefined;this.onTouch=undefined;this.onCorrectTouch=undefined;this.onCorrectMatch=undefined;this.onMatch=undefined;this.onEntry=undefined}componentDidLoad(){d(this.el,this.type)}render(){const t={height:this.height,width:this.width,backgroundColor:this.bgColor,top:this.y,left:this.x,display:this.visible?"flex":"none",zIndex:this.z};return i(e,{key:"2d8c57a7455f695d98a529401a82ce1ff9502a28",class:"col",type:this.type,tabindex:this.tabIndex,value:this.value,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden,audio:this.audio,onTouch:this.onTouch,onMatch:this.onMatch,onCorrectMatch:this.onCorrectMatch,onCorrectTouch:this.onCorrectTouch,onEntry:this.onEntry},i("slot",{key:"5837fe35a93c8133530363678a1f9025af02bb7d"}))}get el(){return n(this)}};u.style=l;const f=".container{position:relative;height:100%;width:100%;background-color:var(--bgColor, #ffffff);display:flex;flex-direction:column;justify-content:center;align-items:center}";const p=f;const b=class{constructor(i){t(this,i);this.id=undefined;this.objective=undefined;this.value=undefined;this.height=undefined;this.width=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.bgColor=undefined;this.type=undefined;this.tabIndex=undefined;this.visible=undefined;this.audio=undefined;this.onTouch=undefined;this.onCorrectTouch=undefined;this.onCorrectMatch=undefined;this.onMatch=undefined;this.onEntry=undefined}scaleContainer(t){var i;const e=[window.innerWidth];if((i=window.screen)===null||i===void 0?void 0:i.width){e.push(window.screen.width)}const n=Math.min(...e);const s=document.documentElement.clientHeight;const d=n/1600;const o=s/900;const h=Math.min(d,o);t.style.transform=`translate(-50%, -50%) scale(${h})`}componentDidLoad(){this.scaleContainer(this.el);document.body.style.backgroundColor=this.bgColor;window.addEventListener("resize",(()=>this.scaleContainer(this.el)));window.addEventListener("load",(()=>this.scaleContainer(this.el)))}render(){const t={backgroundColor:this.bgColor,width:"1600px",height:"900px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"};return i(e,{key:"b991cfcc0b6d6b0ff98f661975c2d3e04c7a6c31",id:"container",tabindex:0,class:"container",objective:this.objective,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden},i("slot",{key:"9751a5ff227ad1ed0cab3f4728cc62501e2c83a2"}))}get el(){return n(this)}};b.style=p;const g=class{constructor(i){t(this,i);this.nextContainer=()=>{localStorage.removeItem(o);localStorage.removeItem(h);if(this.currentContainerIndex<this.containers.length-1){this.currentContainerIndex++}else{this.showCompletionMessage=true;const t=new CustomEvent("gameCompleted");window.dispatchEvent(t);setTimeout((()=>{this.showCompletionMessage=false}),3e3)}this.containers=[...this.containers]};this.xmlData=undefined;this.currentContainerIndex=0;this.showCompletionMessage=false;this.containers=[]}componentWillLoad(){window.addEventListener("nextContainer",this.nextContainer);this.parseXMLData(this.xmlData);window.addEventListener("beforeunload",(()=>{localStorage.removeItem(o);localStorage.removeItem(h)}))}disconnectedCallback(){window.removeEventListener("nextContainer",this.nextContainer)}parseXMLData(t){if(t){const i=new DOMParser;const e=i.parseFromString(t,"text/xml");const n=e.documentElement;this.parseContainers(n)}}parseElement(t){const e=t.nodeName.toLowerCase();const n={};Array.from(t.attributes).forEach((t=>{n[t.name]=t.value}));const s=Array.from(t.childNodes).map((t=>{if(t.nodeType===1){return this.parseElement(t)}else if(t.nodeType===3&&t.textContent.trim()!==""){return t.textContent}return null})).filter(Boolean);const d={"app-container":i("app-container",Object.assign({},n),s),"app-col":i("app-col",Object.assign({},n),s),"app-trace":i("app-trace",Object.assign({},n),s),"app-image":i("app-image",Object.assign({},n),s),"app-row":i("app-row",Object.assign({},n),s),"app-text":i("app-text",Object.assign({},n),s),"app-pos":i("app-pos",Object.assign({},n),s),"app-shape":i("app-shape",Object.assign({},n),s),"app-wrap":i("app-wrap",Object.assign({},n),s),"app-random":i("app-random",Object.assign({},n),s)};if(d[e]){return d[e]}else{console.warn(`Unknown tag: ${e}`);return null}}parseContainers(t){const i=[];const e=t.querySelectorAll("app-container");e.forEach((t=>{const e=this.parseElement(t);if(e){i.push(e)}}));this.containers=i}renderDots(){return i("div",{class:"dot-container"},this.containers.map(((t,e)=>i("span",{class:`dot ${e<this.currentContainerIndex?"completed":e===this.currentContainerIndex?"current":""}`,onClick:()=>this.jumpToContainer(e)}))))}jumpToContainer(t){this.currentContainerIndex=t;this.containers=[...this.containers]}render(){if(!this.xmlData){return i("div",null,"Please provide XML data.")}return i("div",null,i("div",{key:this.currentContainerIndex},this.containers[this.currentContainerIndex]),this.renderDots(),this.showCompletionMessage&&i("div",{class:"snackbar"},"All containers have been displayed!"),i("style",null,`\n            .snackbar {\n              visibility: visible;\n              min-width: 250px;\n              background-color: #333;\n              color: #fff;\n              text-align: center;\n              border-radius: 2px;\n              padding: 16px;\n              position: fixed;\n              z-index: 1;\n              bottom: 30px;\n              left: 50%;\n              transform: translateX(-50%);\n              font-size: 17px;\n            }\n\n            .dot-container {\n              text-align: center;\n              position: relative;\n              z-index: 1;\n            }\n\n            .dot {\n              height: 15px;\n              width: 15px;\n              margin: 0 4px;\n              background-color: #bbb;\n              border-radius: 50%;\n              display: inline-block;\n              transition: background-color 0.3s;\n              cursor: pointer;\n            }\n\n            .dot.completed {\n              background-color: black;\n            }\n\n            .dot.current {\n              background-color: green;\n            }\n\n            .dot:not(.completed):not(.current) {\n              background-color: #bbb;\n            }\n          `))}};const x=".image{user-select:none;-webkit-user-drag:none;object-fit:cover;max-width:100%;max-height:100%;aspect-ratio:1 / 1;}";const y=x;const v=class{constructor(i){t(this,i);this.value=undefined;this.height=undefined;this.width=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.bgColor=undefined;this.type=undefined;this.tabIndex=undefined;this.visible=undefined;this.audio=undefined;this.onTouch=undefined;this.onCorrectTouch=undefined;this.onCorrectMatch=undefined;this.onMatch=undefined;this.onEntry=undefined;this.src=undefined}componentDidLoad(){d(this.el,this.type)}render(){const t={height:this.height,width:this.width,top:this.y,left:this.x,zIndex:this.z,display:this.visible?"flex":"none",alignItems:"center",justifyContent:"center"};return i(e,{key:"589cd372a0494cf30b7fba07a8e88562601eddd8",type:this.type,tabindex:this.tabIndex,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden,value:this.value,audio:this.audio,onTouch:this.onTouch,onMatch:this.onMatch,onCorrectMatch:this.onCorrectMatch,onCorrectTouch:this.onCorrectTouch,onEntry:this.onEntry},i("img",{key:"fe801b40629766a6dc568ba095455b08be8ebd78",class:"image",src:this.src}))}get el(){return n(this)}};v.style=y;const w=".pos{top:var(--y, 0);left:var(--x, 0);height:var(--height, 100%);width:var(--width, 100%);background-color:var(--bgColor, #eeeeee);display:flex;justify-content:space-around;flex-direction:column;position:fixed}.pos>*{position:absolute}";const m=w;const k=class{constructor(i){t(this,i);this.id=undefined;this.value=undefined;this.height=undefined;this.width=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.bgColor=undefined;this.type=undefined;this.tabIndex=undefined;this.visible=undefined;this.audio=undefined;this.onTouch=undefined;this.onCorrectTouch=undefined;this.onCorrectMatch=undefined;this.onMatch=undefined;this.onEntry=undefined}componentDidLoad(){d(this.el,this.type)}render(){const t={height:this.height,width:this.width,backgroundColor:this.bgColor,top:this.y,left:this.x,zIndex:this.z,display:this.visible?"block":"none"};return i(e,{key:"4e938b5b651df41fbc6a887cd8234a73e9a25864",class:"pos",type:this.type,tabindex:this.tabIndex,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden,value:this.value,audio:this.audio,onTouch:this.onTouch,onMatch:this.onMatch,onCorrectMatch:this.onCorrectMatch,onCorrectTouch:this.onCorrectTouch,onEntry:this.onEntry},i("slot",{key:"bb63e4d68ff11ae8b71729cba1d8aeef06856279"}))}get el(){return n(this)}};k.style=m;const C=".random{display:flex;justify-content:space-between;align-items:center;position:absolute;}.random>*{position:absolute}";const M=C;const T=class{constructor(i){t(this,i);this.id=undefined;this.value=undefined;this.height=undefined;this.width=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.bgColor=undefined;this.type=undefined;this.tabIndex=undefined;this.visible=undefined;this.audio=undefined;this.onTouch=undefined;this.onCorrectTouch=undefined;this.onCorrectMatch=undefined;this.onMatch=undefined;this.onEntry=undefined}componentDidLoad(){const t=this.el.querySelectorAll(".random > *");t.forEach((t=>{const i=Math.random()*100;const e=Math.random()*100;t.style.top=`${i}%`;t.style.left=`${e}%`}))}render(){const t={height:this.height,width:this.width,top:this.y,left:this.x,display:this.visible?"block":"none",zIndex:this.z,backgroundColor:this.bgColor};return i(e,{key:"3e1c8012a1978b57d0620f55894ba889087e64a2",class:"random",type:this.type,tabindex:this.tabIndex,value:this.value,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden,audio:this.audio,onTouch:this.onTouch,onMatch:this.onMatch,onCorrectMatch:this.onCorrectMatch,onCorrectTouch:this.onCorrectTouch,onEntry:this.onEntry},i("slot",{key:"b9b11c77e737146fd37af5feb75df844253c7f14"}))}get el(){return n(this)}};T.style=M;const j=class{constructor(i){t(this,i);this.xmlData=undefined}async componentWillLoad(){const t=s("./assets/xmlData.xml");const i=await fetch(t);const e=await i.text();this.xmlData=e}render(){if(!this.xmlData){return i("div",null,"Loading...")}return i("app-home",{xmlData:this.xmlData})}static get assetsDirs(){return["assets"]}};const $=".row{display:flex;justify-content:space-between;align-items:center;}.row>*{}";const D=$;const I=class{constructor(i){t(this,i);this.value=undefined;this.height=undefined;this.width=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.bgColor=undefined;this.type=undefined;this.tabIndex=undefined;this.visible=undefined;this.audio=undefined;this.onTouch=undefined;this.onCorrectTouch=undefined;this.onCorrectMatch=undefined;this.onMatch=undefined;this.onEntry=undefined}componentDidLoad(){d(this.el,this.type)}render(){const t={height:this.height,width:this.width,top:this.y,left:this.x,display:this.visible?"flex":"none",zIndex:this.z,backgroundColor:this.bgColor};return i(e,{key:"816dd718dc31b5b9dd56729b78598a0612571435",class:"row",type:this.type,tabindex:this.tabIndex,value:this.value,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden,audio:this.audio,onTouch:this.onTouch,onMatch:this.onMatch,onCorrectMatch:this.onCorrectMatch,onCorrectTouch:this.onCorrectTouch,onEntry:this.onEntry},i("slot",{key:"012af54a39b8e3fdca8269df4d9f4265728eef5c"}))}get el(){return n(this)}};I.style=D;const z=".shape{position:absolute;top:var(--y);left:var(--x);display:var(--display);z-index:var(--z)}.rectangle{border-radius:0}.circle{width:var(--width);height:var(--width);border-radius:50%;background-color:var(--bgColor)}.ellipse{width:var(--width);height:var(--height);border-radius:50%;background-color:var(--bgColor)}";const L=z;const P=class{constructor(i){t(this,i);this.id=undefined;this.value=undefined;this.height=undefined;this.width=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.bgColor=undefined;this.type=undefined;this.tabIndex=undefined;this.shapeType=undefined;this.visible=undefined;this.audio=undefined;this.onTouch=undefined;this.onCorrectTouch=undefined;this.onCorrectMatch=undefined;this.onMatch=undefined;this.onEntry=undefined}componentDidLoad(){d(this.el,this.type)}render(){const t={height:this.shapeType!=="polygon"?this.height:undefined,width:this.shapeType!=="polygon"?this.width:undefined,top:this.y,left:this.x,display:this.visible?"block":"none",zIndex:this.z,backgroundColor:this.shapeType!=="polygon"?this.bgColor:"transparent"};return i(e,{key:"8f3d55de74d28a3f15a1fb8209ccf5cc418c2d8d",class:`shape ${this.shapeType}`,value:this.value,type:this.type,tabindex:this.tabIndex,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden,audio:this.audio,onTouch:this.onTouch,onMatch:this.onMatch,onCorrectMatch:this.onCorrectMatch,onCorrectTouch:this.onCorrectTouch,onEntry:this.onEntry})}get el(){return n(this)}};P.style=L;const E=".text{background-color:#fff;box-shadow:0 2px 4px rgba(0, 0, 0, 0.1);transition:background-color 0.3s ease;user-select:none;align-items:center;justify-content:center;text-align:center;border-radius:8px;color:#333;cursor:pointer}.text:hover{background-color:#f0f0f0}";const S=E;const O=class{constructor(i){t(this,i);this.id=undefined;this.value=undefined;this.string=undefined;this.font=undefined;this.fontSize=undefined;this.fontColor=undefined;this.highlightWhileSpeaking=undefined;this.height=undefined;this.width=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.bgColor=undefined;this.type=undefined;this.tabIndex=undefined;this.visible=undefined;this.audio=undefined;this.onTouch=undefined;this.onCorrectTouch=undefined;this.onCorrectMatch=undefined;this.onMatch=undefined;this.onEntry=undefined}componentDidLoad(){d(this.el,this.type)}render(){const t={height:this.height,width:this.width,backgroundColor:this.bgColor,top:this.y,left:this.x,zIndex:this.z,fontSize:this.fontSize,fontFamily:this.font,color:this.fontColor,display:this.visible?"flex":"none"};return i(e,{key:"896e5866dc3ec25af2c18f666c26281930b3d0b0",class:"text",value:this.value,type:this.type,tabindex:this.tabIndex,audio:this.audio,onTouch:this.onTouch,onMatch:this.onMatch,onCorrectMatch:this.onCorrectMatch,onCorrectTouch:this.onCorrectTouch,onEntry:this.onEntry,id:this.id,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden},this.string)}get el(){return n(this)}};O.style=S;const _=":host{display:block;position:relative}#svgContainer{position:absolute;top:0;left:0;right:0;bottom:50px;display:flex;justify-content:center;align-items:center;overflow:hidden}svg{width:100%;height:100%;max-height:calc(100vh - 50px);touch-action:none}#draggableCircle{cursor:pointer;fill:red;transition:fill 0.2s, r 0.2s}.blindTracing{stroke:none !important}.blindFreeTrace{stroke:none !important}.hovered{cursor:grab;fill:darkred}#controls{position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-between;padding:10px;background-color:#f0f0f0;border-top:1px solid #ccc}button{padding:10px;font-size:16px}@media (max-width: 600px){button{padding:8px;font-size:14px}}.trace-path-green{stroke:green !important}";const F=_;const G=class{constructor(i){t(this,i);this.id=undefined;this.svgSource=undefined;this.value=undefined;this.height=undefined;this.width=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.tabIndex=undefined;this.mode=undefined;this.fileIndex=-1;this.isDragging=false;this.activePointerId=null}async initializeSVG(){let t={fileIndex:-1,currentPathIndex:0,lastLength:0,totalPathLength:0,isDragging:false,circle:null,paths:[],svg:null,proximityThreshold:100,freeTraceProximityThreshold:50,rafId:null,pointerMoveEvent:null,activePointerId:null,mode:this.mode,flowMarkers:[],freeTraceLines:[]};await this.loadAnotherSVG(t,true)}componentWillLoad(){this.initializeSVG()}async fetchSVG(t){const i=await fetch(t);if(!i.ok){throw new Error(`Failed to fetch SVG (${t}): ${i.statusText}`)}return await i.text()}calculateBoundingBox(t,i=22){let e=Infinity,n=Infinity,s=-Infinity,d=-Infinity;t.forEach((t=>{const i=t.getTotalLength();const o=100;for(let h=0;h<=o;h++){const a=t.getPointAtLength(h/o*i);if(a.x<e)e=a.x;if(a.y<n)n=a.y;if(a.x>s)s=a.x;if(a.y>d)d=a.y}}));e-=i;n-=i;s+=i;d+=i;return{minX:e,minY:n,maxX:s,maxY:d}}insertSVG(t){const i=document.getElementById("svgContainer");i.innerHTML=t;const e=i.querySelector("svg");e.removeAttribute("width");e.removeAttribute("height");const n=e.querySelectorAll("path, line");const s=this.calculateBoundingBox(Array.from(n));const d=s.maxX-s.minX;const o=s.maxY-s.minY;e.setAttribute("viewBox",`${s.minX} ${s.minY} ${d} ${o}`)}getSVGElement(){const t=document.getElementById("svgContainer");return t.querySelector("svg")}getPaths(t){return Array.from(t.querySelectorAll("path, line"))}createFlowMarkersForPath(t,i=10){var e;const n=t.getTotalLength();const s=n/(i+1);const d=[];for(let n=1;n<=i;n++){const i=t.getPointAtLength(n*s);const o=t.getPointAtLength((n+.5)*s);const h=Math.atan2(o.y-i.y,o.x-i.x);const a=document.createElementNS("http://www.w3.org/2000/svg","polygon");a.setAttribute("points","-5,-5 0,0 -5,5");a.setAttribute("fill","blue");a.setAttribute("transform",`translate(${i.x},${i.y}) rotate(${h*180/Math.PI})`);a.setAttribute("class","flow-indicator");d.push(a);(e=t.parentNode)===null||e===void 0?void 0:e.appendChild(a)}return d}updateFlowIndicators(t){const i=t.svg.querySelectorAll(".flow-indicator");i.forEach((i=>{if(t.mode===a.NoFlow){i.style.display="none"}else if(t.mode===a.ShowFlow){i.style.display="block"}}))}setupDrawingPath(t){t.paths.forEach(((i,e)=>{const n=i.getTotalLength();const s=i.cloneNode();s.setAttribute("stroke","green");s.setAttribute("stroke-width","13");s.setAttribute("stroke-dasharray",n.toString());s.setAttribute("stroke-dashoffset",n.toString());i.parentNode.appendChild(s,i);i.setAttribute("class","trace-path");s.setAttribute("class","trace-path-green");i.greenPath=s;i.classList.add(t.mode);if(t.mode===a.BlindTracing||t.mode===a.BlindFreeTrace){i.setAttribute("stroke","none")}else{i.setAttribute("stroke","#000");i.setAttribute("stroke-width","10");i.setAttribute("fill","none");i.setAttribute("stroke-dasharray",n.toString());i.setAttribute("stroke-dashoffset","0")}if(e===t.currentPathIndex&&t.mode===a.ShowFlow){t.flowMarkers=this.createFlowMarkersForPath(i)}}));t.totalPathLength=t.paths[t.currentPathIndex].getTotalLength()}setupDraggableCircle(t){var i;const e=t.paths[0].getPointAtLength(0);const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("id","draggableCircle");n.setAttribute("cx",e.x.toString());n.setAttribute("cy",e.y.toString());n.setAttribute("r","20");n.setAttribute("fill","red");(i=t.svg)===null||i===void 0?void 0:i.appendChild(n);t.circle=n}addEventListeners(t){var i,e,n,s;if(!t.circle||!t.paths||t.paths.length===0)return;t.circle.addEventListener("pointerdown",(i=>{i.preventDefault();const e=this.getPointerPosition(i,t.svg);const n={x:parseFloat(t.circle.getAttribute("cx")),y:parseFloat(t.circle.getAttribute("cy"))};const s=this.getDistanceSquared(e,n);if(s<=t.proximityThreshold*t.proximityThreshold){t.isDragging=true;t.activePointerId=i.pointerId;t.circle.setPointerCapture(i.pointerId)}}));(i=t.svg)===null||i===void 0?void 0:i.addEventListener("pointermove",(i=>{if(!t.isDragging||i.pointerId!==t.activePointerId)return;t.pointerMoveEvent=i;if(!t.rafId){t.rafId=requestAnimationFrame((()=>{this.handlePointerMove(t);t.rafId=null}))}}));(e=t.svg)===null||e===void 0?void 0:e.addEventListener("pointerup",(i=>{if(i.pointerId===t.activePointerId){t.isDragging=false;t.activePointerId=null}}));(n=t.svg)===null||n===void 0?void 0:n.addEventListener("pointercancel",(i=>{if(i.pointerId===t.activePointerId){t.isDragging=false;t.activePointerId=null}}));(s=t.svg)===null||s===void 0?void 0:s.addEventListener("contextmenu",(t=>{t.preventDefault()}))}handlePointerMove(t){var i,e,n,s;if(!t.isDragging)return;if(!t.circle||!t.paths||t.paths.length===0)return;const d=t.pointerMoveEvent;const o=this.getPointerPosition(d,t.svg);const h={x:parseFloat(t.circle.getAttribute("cx")),y:parseFloat(t.circle.getAttribute("cy"))};const c=t.paths[t.currentPathIndex];if(!c){console.error("No valid path found at the current index");return}let l;if(t.mode===a.FreeTrace||t.mode===a.BlindFreeTrace){l=t.freeTraceProximityThreshold*t.freeTraceProximityThreshold}else{l=t.proximityThreshold*t.proximityThreshold}const u=this.getDistanceSquared(o,h);if(u>l){return}const f=this.getClosestPointOnPath(c,o);const p=this.getDistanceSquared(o,f);if(p>l){return}if(t.mode===a.FreeTrace||t.mode===a.BlindFreeTrace){if(!t.currentFreePath){t.currentFreePath=[]}if(!t.currentFreePath[t.currentPathIndex]){const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("stroke","green");e.setAttribute("stroke-width","8");e.setAttribute("fill","none");e.setAttribute("d",`M${o.x},${o.y}`);(i=t.svg)===null||i===void 0?void 0:i.appendChild(e);t.currentFreePath[t.currentPathIndex]=e;t.lastPointerPos=o}const n=t.lastPointerPos||o;const s=t.currentFreePath[t.currentPathIndex].getAttribute("d");const d=(n.x+o.x)/2;const h=(n.y+o.y)/2;const a=`${s} Q ${n.x},${n.y} ${d},${h}`;t.currentFreePath[t.currentPathIndex].setAttribute("d",a);t.circle.setAttribute("cx",o.x.toString());t.circle.setAttribute("cy",o.y.toString());(e=t.svg)===null||e===void 0?void 0:e.appendChild(t.circle);t.lastPointerPos=o;const r=c.getTotalLength();const l=r-f.length;if(l<5){this.moveToNextPath(t);t.currentFreePath[t.currentPathIndex]=null}return}if(t.isDragging&&f.length>=t.lastLength){t.lastLength=f.length;t.circle.setAttribute("cx",f.x.toString());t.circle.setAttribute("cy",f.y.toString());(n=t.svg)===null||n===void 0?void 0:n.appendChild(t.circle);(s=c.greenPath)===null||s===void 0?void 0:s.setAttribute("stroke-dashoffset",(t.totalPathLength-t.lastLength).toString())}if(t.totalPathLength-1-t.lastLength<5&&t.currentPathIndex<t.paths.length-1){this.moveToNextPath(t)}else if(t.totalPathLength-1-t.lastLength<5&&t.currentPathIndex===t.paths.length-1){r()}}getPointerPosition(t,i){var e;const n=i.createSVGPoint();n.x=t.clientX;n.y=t.clientY;const s=(e=i.getScreenCTM())===null||e===void 0?void 0:e.inverse();return s?n.matrixTransform(s):{x:t.clientX,y:t.clientY}}getDistanceSquared(t,i){const e=t.x-i.x;const n=t.y-i.y;return e*e+n*n}getClosestPointOnPath(t,i){const e=t.getTotalLength();let n={x:0,y:0,length:0};let s=Infinity;const d=20;let o={x:0,y:0,length:0};let h=Infinity;for(let n=0;n<=e;n+=d){const e=t.getPointAtLength(n);const s=this.getDistanceSquared(i,e);if(s<h){h=s;o={x:e.x,y:e.y,length:n}}}const a=2;const r=Math.max(o.length-d,0);const c=Math.min(o.length+d,e);for(let e=r;e<=c;e+=a){const d=t.getPointAtLength(e);const o=this.getDistanceSquared(i,d);if(o<s){s=o;n={x:d.x,y:d.y,length:e}}}return n}async loadAnotherSVG(t,i){t.isDragging=false;try{if(t.svg){this.cleanupPreviousSVG(t)}const i=await this.fetchSVG(this.svgSource);this.insertSVG(i);t.svg=this.getSVGElement();t.paths=this.getPaths(t.svg);this.setupDrawingPath(t);this.setupDraggableCircle(t);this.addEventListeners(t)}catch(t){console.error(`Error loading SVG (${this.svgSource}):`,t)}}cleanupPreviousSVG(t){var i,e;if(t.circle){(i=t.svg)===null||i===void 0?void 0:i.removeChild(t.circle);t.circle=null}const n=(e=t.svg)===null||e===void 0?void 0:e.querySelectorAll(".flow-indicator");n.forEach((t=>{t.remove()}));t.currentPathIndex=0;t.lastLength=0;t.totalPathLength=t.paths[0].getTotalLength()}moveToNextPath(t){var i,e;t.isDragging=false;t.currentPathIndex++;t.lastLength=0;if(t.currentPathIndex>=t.paths.length){r();return}const n=t.paths[t.currentPathIndex];if(!n){console.error("No valid path found at the next index");return}t.totalPathLength=n.getTotalLength();const s=n.getPointAtLength(0);(i=t.circle)===null||i===void 0?void 0:i.setAttribute("cx",s.x.toString());(e=t.circle)===null||e===void 0?void 0:e.setAttribute("cy",s.y.toString());if(t.mode===a.ShowFlow){t.flowMarkers=this.createFlowMarkersForPath(n)}}render(){const t={height:this.height,width:this.width,top:this.y,left:this.x,zIndex:this.z,position:"absolute"};return i(e,{key:"c957926b2f3e281966de8d1dca6580931af54019",class:"trace",id:this.id,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden,tabindex:this.tabIndex},i("div",{key:"f841bf92fec27ed26594c5ccca937fa20210451f",id:"svgContainer"}))}static get assetsDirs(){return["svg"]}};G.style=F;const V=".wrap{display:grid;grid-gap:10px;grid-template-columns:repeat(auto-fill, minmax(186px, auto))}.wrap>*{padding:10px;background-color:var(--child-bg-color, #f0f0f0);box-sizing:border-box}";const A=V;const X=class{constructor(i){t(this,i);this.id=undefined;this.value=undefined;this.height=undefined;this.width=undefined;this.ariaLabel=undefined;this.ariaHidden=undefined;this.x=undefined;this.y=undefined;this.z=undefined;this.bgColor=undefined;this.type=undefined;this.tabIndex=undefined;this.visible=undefined;this.audio=undefined;this.onTouch=undefined;this.onCorrectTouch=undefined;this.onCorrectMatch=undefined;this.onMatch=undefined;this.onEntry=undefined}componentDidLoad(){d(this.el,this.type)}render(){const t={height:this.height,width:this.width,top:this.y,left:this.x,display:this.visible?"grid":"none",zIndex:this.z,backgroundColor:this.bgColor};return i(e,{key:"f67c990a558ecdec6b065b60486f382f9252fa74",class:"wrap",value:this.value,type:this.type,tabindex:this.tabIndex,style:t,"aria-label":this.ariaLabel,"aria-hidden":this.ariaHidden,audio:this.audio,onTouch:this.onTouch,onMatch:this.onMatch,onCorrectMatch:this.onCorrectMatch,onCorrectTouch:this.onCorrectTouch,onEntry:this.onEntry},i("slot",{key:"c86e76c247bc0c3fa00e61e9c5f6781f485e4e10"}))}get el(){return n(this)}};X.style=A;export{u as app_col,b as app_container,g as app_home,v as app_image,k as app_pos,T as app_random,j as app_root,I as app_row,P as app_shape,O as app_text,G as app_trace,X as app_wrap};
//# sourceMappingURL=p-fdea7b47.entry.js.map