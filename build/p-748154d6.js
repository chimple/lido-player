const t="dragSelectedMap";const n="selectedValues";const e="nextContainer";const o="activityChange";const c="gameCompleted";const s="elementDrop";const a="elementClick";var r;(function(t){t["NoFlow"]="noFlow";t["ShowFlow"]="showFlow";t["FreeTrace"]="freeTrace";t["BlindTracing"]="blindTracing";t["BlindFreeTrace"]="blindFreeTrace"})(r||(r={}));function i(t,n){const e=new CustomEvent(t,{detail:n});window.dispatchEvent(e)}function l(){i(e,{})}function u(){i(c,{})}function f(t){i(o,{index:t})}function d(t,n,e){i(s,{dragElement:t,dropElement:n,isCorrect:e,createdAt:(new Date).toISOString()})}function m(t,n){i(a,{element:t,isCorrect:n,createdAt:(new Date).toISOString()})}function h(t,n,e){return(t||"")+(n?` ${n}`:"")+(e?` ${e}`:"")}const g=t=>{const n=window.getComputedStyle(t).transform;if(n==="none"){return 1}else{const t=n.match(/matrix\(([^)]+)\)/);if(t){const n=t[1].split(", ");const e=parseFloat(n[0]);return e}}return 1};function p(t){let n=false;let e=0;let o=0;let c=0;let s=0;const a=document.getElementById("container");if(!a){console.error(`Container with ID "container" not found.`);return}const r=a=>{$(t);n=true;if(a instanceof MouseEvent){e=a.clientX;o=a.clientY}else{e=a.touches[0].clientX;o=a.touches[0].clientY}t.style.opacity="0.8";t.style.cursor="grabbing";const r=window.getComputedStyle(t).transform;if(r!=="none"){const t=r.match(/matrix\(([^)]+)\)/);if(t){const n=t[1].split(", ");c=parseFloat(n[4]);s=parseFloat(n[5])}}else{c=0;s=0}document.addEventListener("mousemove",h);document.addEventListener("mouseup",p);document.addEventListener("touchmove",h);document.addEventListener("touchend",p)};const i=a.getBoundingClientRect();const l=t.getBoundingClientRect();let u=i.top-l.top;let f=i.left-l.left;const d=new MutationObserver((n=>{for(const e of n){if(e.type==="attributes"&&e.attributeName==="style"){const n=a.getBoundingClientRect();const e=t.getBoundingClientRect();u=n.top-e.top;f=n.left-e.left}}}));const m={attributes:true,attributeFilter:["style"]};d.observe(a,m);const h=r=>{if(!n)return;const i=g(a);let l=0;let d=0;if(r instanceof MouseEvent){l=(r.clientX-e)/i;d=(r.clientY-o)/i}else{l=(r.touches[0].clientX-e)/i;d=(r.touches[0].clientY-o)/i}const m=c+l;const h=s+d;const p=a.getBoundingClientRect();const w=t.getBoundingClientRect();const b=t.style.transform.match(/-?\d+(\.\d+)?/g);const x=b.map(Number);const k=w.left/i-x[0];const y=w.top-x[1];const v=p.width/i-Math.abs(f/i)-w.width/i;const S=p.left-k;const C=p.top-y;const M=p.height/i-Math.abs(u/i)-w.height/i;const N=m+k<=p.left?S:Math.min(m,v);const O=h+y<=p.top?C:Math.min(h,M);t.style.transform=`translate(${N}px, ${O}px)`;const T=document.querySelectorAll("[type='drop']");let E=null;let J=0;T.forEach((t=>{const n=t.getBoundingClientRect();const e=Math.max(0,Math.min(w.right,n.right)-Math.max(w.left,n.left));const o=Math.max(0,Math.min(w.bottom,n.bottom)-Math.max(w.top,n.top));const c=e*o;if(c>J){J=c;E=t}}));T.forEach((t=>{t.style.border="";t.style.backgroundColor=""}));if(E){E.style.border="2px dashed #ff0000";E.style.backgroundColor="rgba(255, 0, 0, 0.1)"}};const p=e=>{n=false;document.removeEventListener("mousemove",h);document.removeEventListener("mouseup",p);document.removeEventListener("touchmove",h);document.removeEventListener("touchend",p);t.style.opacity="";t.style.cursor="move";const o=document.querySelectorAll("[type='drop']");o.forEach((t=>{t.style.border="";t.style.backgroundColor=""}));const c=t.getBoundingClientRect();let s=null;let a=0;o.forEach((t=>{const n=t.getBoundingClientRect();const e=Math.max(0,Math.min(c.right,n.right)-Math.max(c.left,n.left));const o=Math.max(0,Math.min(c.bottom,n.bottom)-Math.max(c.top,n.top));const r=e*o;if(r>a){a=r;s=t}}));w(t,s)};t.style.cursor="move";t.style.transform="translate(0, 0)";t.addEventListener("mousedown",r);t.addEventListener("touchstart",r);t.addEventListener("click",(n=>{J(t,"drag")}))}async function w(e,o){if(!o){const o=localStorage.getItem(n);const c=localStorage.getItem(t);if(o){let t=JSON.parse(o);t=t.filter((t=>t!=e["value"]));localStorage.setItem(n,JSON.stringify(t))}if(c){let n=JSON.parse(c);const o=e.parentElement.getAttribute("tabIndex");console.log("drop index",o);if(o&&n.hasOwnProperty(o)){delete n[o]}localStorage.setItem(t,JSON.stringify(n))}S();return}const c=k(o["value"],[e["value"]]);d(e,o,c);if(c){const t=o.getAttribute("onCorrect");if(t){await b(t,o,e)}}else{const t=o.getAttribute("onInCorrect");await b(t,o,e)}await v(e,o)}const b=async(t,n,e)=>{const o=x(t);for(let t=0;t<o.length;t++){const c=o[t];const s=c.actor==="this"?n:c.actor==="element"?e:document.getElementById(c.actor);if(s){switch(c.action){case"transform":{const t=window.getComputedStyle(s).transform;s.style.transform=t!=="none"?`${t} ${c.value}`:c.value;break}case"alignMatch":{const t=s;const n=e;if(t.childElementCount==0){n.style.transform="translate(0, 0)";t.appendChild(n)}else{n.style.transform="translate(0, 0)";n.parentElement.appendChild(t.firstChild);t.appendChild(n)}break}case"addClass":{s.classList.add(c.value);break}case"speak":{{let t=s.getAttribute("audio");if(t){t=I(t);let n=document.getElementById("audio");if(!n){const t=document.createElement("audio");t.id="audio";document.body.appendChild(t);n=t}n.pause();n.currentTime=0;n.src=t;console.log("ðŸš€ ~ executeActions ~ audioElement.src:",n.src);try{await n.play();D(s);while(!n.ended||n.error){await new Promise((t=>setTimeout(t,100)))}F(s)}catch(t){console.log("ðŸš€ ~ executeActions ~ audioElement.src: error",t)}}break}}case"sleep":{const t=!isNaN(Number(c.value));if(t){await new Promise((t=>setTimeout(t,Number(c.value))))}break}default:{s.style[c.action]=c.value;break}}}}};const x=t=>{var n;const e=[];if(!t)return e;const o=(n=t.split(";"))===null||n===void 0?void 0:n.map((t=>t.trim()));o.forEach((t=>{if(t){const[n,o]=t.split("=").map((t=>t.trim()));const c=n.lastIndexOf(".");if(c!==-1){const t=n.substring(0,c).trim();const s=n.substring(c+1).trim();e.push({actor:t,action:s,value:o.replace(/['"]/g,"")})}}}));return e};const k=(t,n)=>{const e=t.split(",").map((t=>t.trim()));let o=0;let c=new Set;for(const t of e){if(t.startsWith("(")&&t.endsWith(")")){const e=t.slice(1,-1).split("|").map((t=>t.trim()));if(o>=n.length)return false;if(!e.includes(n[o]))return false;o++}else if(t.includes("|")){const n=t.split("|").map((t=>t.trim()));for(const t of n){c.add(t)}}else{if(o>=n.length||n[o]!==t)return false;o++}}while(o<n.length){if(!c.has(n[o])){return false}c.delete(n[o]);o++}return o===n.length};const y=t=>{const n=t.split(",").map((t=>t.trim()));let e=0;for(const t of n){if(t.startsWith("(")&&t.endsWith(")")){e+=1}else{e+=t.split("|").length}}return e};async function v(e,o){var c;const s=document.getElementById("container");if(!s)return;const a=s.getAttribute("isAllowOnlyCorrect")==="true";if(a){const t=k(o["value"],[e["value"]]);if(!t){e.style.transform="translate(0,0)";return}}await b("this.alignMatch='true'",o,e);let r=JSON.parse((c=localStorage.getItem(t))!==null&&c!==void 0?c:"{}");if(!r[o.getAttribute("tabindex")]){r[o.getAttribute("tabindex")]=[]}r[o.getAttribute("tabindex")]=[e["value"]];localStorage.setItem(t,JSON.stringify(r));const i=Object.keys(r).sort(((t,n)=>parseInt(t)-parseInt(n)));const l=i.reduce(((t,n)=>t.concat(r[n])),[]);localStorage.setItem(n,JSON.stringify(l));S()}const S=()=>{var t;const e=document.getElementById("container");const o=e["objective"];const c=JSON.parse((t=localStorage.getItem(n))!==null&&t!==void 0?t:"[]");const s=document.getElementById("checkButton");if(!c||c.length!==y(o)){b("this.addClass='disable-check-button'",s);return}const a=e.getAttribute("showCheck")=="true";if(a){s.classList.remove("disable-check-button")}else{C()}};const C=async()=>{var t;const e=document.getElementById("container");if(!e)return;const o=e["objective"];const c=JSON.parse((t=localStorage.getItem(n))!==null&&t!==void 0?t:"[]");const s=k(o,c);if(s){const t=e.getAttribute("onCorrect");if(t){await b(t,e)}await new Promise((t=>setTimeout(t,1e3)));M()}else{const t=e.getAttribute("onInCorrect");await b(t,e);const n=e.getAttribute("isContinueOnCorrect")==="true";if(!n){await new Promise((t=>setTimeout(t,1e3)));M()}}};const M=()=>{console.log("ðŸš€ ~ triggerNextContainer ~ event:",event);l()};const N=async(t,n)=>{const e=document.getElementById("container");if(!e)return;const o=e.getAttribute("canplay");if(o!=null&&o==="false")return;switch(n){case"drag":{p(t);break}case"click":{T(t);break}case"drop":{E(t);break}}const c=t.getAttribute("onEntry");await b(c,t);O(t)};function O(t){if(!t)return;const n=t.getAttribute("onTouch");console.log(n);if(!n)return;t.onclick=async()=>{console.log("ðŸš€ ~ element.onclick= ~ onTouch:",n);if(!n)return;await b(n,t)}}function T(t){t.style.cursor="pointer";if(!t){console.error("No element provided.");return}const e=async()=>{const e=document.getElementById("container");console.log("Element clicked:",t);if(t.getAttribute("id")=="checkButton"){M();return}localStorage.setItem(n,JSON.stringify([t["value"]]));t.style.border="2px solid yellow";t.style.boxShadow="0px 0px 10px rgba(255, 255, 0, 0.7)";t.style.transition="transform 0.2s ease, border 0.5s ease";t.style.transform="scale(1.1)";t.style.transform="scale(1)";t.style.border="";t.style.boxShadow="";const o=e["objective"];const c=k(o,[t["value"]]);m(t,c);if(c){const n=t.getAttribute("onCorrect");await b(n,t)}else{const n=t.getAttribute("onInCorrect");await b(n,t)}await v()};t.addEventListener("click",e)}function E(t){t.onclick=()=>{J(t,"drop")}}async function J(t,n){const e=document.querySelectorAll(`[type='${n}']`);e.forEach((t=>{$(t)}));if(!document.getElementById("dynamic-highlight-style")){const t=document.createElement("style");t.id="dynamic-highlight-style";t.innerHTML=`\n      .highlight {\n        border: 4px solid #e74c3c; /* Thicker red border for more visibility */\n        border-radius: 12px; /* Larger rounded corners */\n        background-color: rgba(231, 76, 60, 0.3); /* Stronger, more noticeable background */\n        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2), 0 12px 40px rgba(0, 0, 0, 0.2); /* Stronger shadow */\n        outline: 4px solid rgba(231, 76, 60, 0.6); /* Glow effect */\n      }\n    `;document.head.appendChild(t)}t===null||t===void 0?void 0:t.classList.add("highlight");t.ariaPressed="true";const o=n==="drop"?t:document.querySelector("[type='drop'].highlight");const c=n==="drag"?t:document.querySelector("[type='drag'].highlight");if(o&&c){c.style.transition="transform 0.5s ease";c.style.transform="";const t=document.getElementById("container");const n=g(t);console.log("ðŸš€ ~ onClickDropOrDragElement ~ containerScale:",n);const e=o.getBoundingClientRect();const s=c.getBoundingClientRect();const a=(e.left-s.left)/n;const r=(e.top-s.top)/n;c.style.transform=`translate(${a}px, ${r}px)`;const i=document.querySelectorAll(`*`);i.forEach((t=>{$(t)}));await new Promise((t=>setTimeout(t,500)));await w(c,o);await new Promise((t=>setTimeout(t,500)));c.style.transform="translate(0px, 0px)"}}function $(t){t.classList.remove("highlight");t.ariaPressed="false"}function D(t){if(!t)return;t.classList.add("speaking-highlight");const n="speaking-highlight-style";if(!document.getElementById(n)){const t=document.createElement("style");t.id=n;t.innerHTML=`\n      .speaking-highlight {\n        box-shadow: 0 0 20px 10px rgba(255, 165, 0, 0.9); /* Stronger orange glow effect */\n        border: 3px solid orange;\n        transition: box-shadow 0.5s ease-in-out, transform 0.5s ease-in-out;\n        transform: scale(1.05); /* Subtle scale effect to pop the element */\n        animation: pulseEffect 1.5s infinite; /* Pulsing animation */\n      }\n\n      @keyframes pulseEffect {\n        0% {\n          box-shadow: 0 0 20px 10px rgba(255, 165, 0, 0.9);\n          transform: scale(1.05);\n        }\n        50% {\n          box-shadow: 0 0 30px 15px rgba(255, 165, 0, 1);\n          transform: scale(1.1);\n        }\n        100% {\n          box-shadow: 0 0 20px 10px rgba(255, 165, 0, 0.9);\n          transform: scale(1.05);\n        }\n      }\n    `;document.head.appendChild(t)}}function F(t){if(!t)return;t.classList.remove("speaking-highlight");t.style.boxShadow="";t.style.border=""}function I(t){if(t.startsWith("http")){return t}const n=document.getElementById("container");if(!n)return t;const e=n.getAttribute("baseUrl");if(!e)return t;return e+t}export{t as D,n as S,r as T,u as a,I as c,f as d,h as f,N as i,M as t};
//# sourceMappingURL=p-748154d6.js.map